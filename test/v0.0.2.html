<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content=-type" content"text/html;charset=utf-8">
	<title></title>
</head>
<body>
	<button onclick="test1();">测试1</button>
	<button onclick="test2();">测试2</button>
	<button onclick="test3();">测试3</button>
	<button onclick="test4();">测试4</button>
	<button onclick="test5();">测试5</button>
	<button onclick="test6();">测试6</button>
	<script type="text/javascript" src="../src/iPromise.js"></script>
	<script type="text/javascript">
	var promise = new iPromise()
	var test1 = function(){
		promise.resolve('hello1')
		promise
			.then(function(data){
				alert(data)
				// test2: 测试返回值为Promise实例
				var p2 = new iPromise()
				setTimeout(function(){
					p2.resolve('hello2')	
				}, 2000)
				return p2
			})
			.then(function(data){
				alert(data)
				// test3: 测试返回值为thenable实例
				var thenable = {
					then: function(resolve, reject){
						resolve('hello3');
					}	
				};
				return thenable
			})
			.then(function(data){
				alert(data)
				// test4: 测试返回值为非Promise或thenable实例
			})
			.then(function(data){
				alert(data)
			})
	}
	var promise2 = new iPromise()	
	var test2 = function(){
		promise2.resolve('hello');
		promise2
			.then(null)
			.then(function(data){
				alert(data);
				throw new Error('my error!');
			})
			.then(function(data){
				alert('ok');	
			})
			.catch(function(data){
				alert(data);	
			});
	};
	var test3 = function(){
		var promise3 = iPromise(function(resolve, reject, notify){
			notify('test')	
		});		
		promise3.then(function(data){
			alert(data);
			return new iPromise(function(resolve){
				resolve('hello2');
			});
		}).then(function(data){
			alert(data);
		}).progress(function(v){
			alert(v);
			return new iPromise(function(resolve, reject, notify){
				notify('hello7');
			});
		}).then().progress(function(t){
			alert(t)
		});
	};
	var p4 = iPromise(function(resolve){
		resolve('test', 'test2')
	})
	var test4 = function(){
		p4.then(function(arg1, arg2){
			alert(arg1 + ':' + arg2)
		})
	}
	var p = iPromise()
	var p4 = iPromise(function(resolve){
		resolve('test1', 'test2')
	}).then(function(arg1, arg2){
			alert(arg1 + ':' + arg2)
			p.resolve('hello', 'world')
			return p
		})
	var test5 = function(){
		p4.then(function(arg1, arg2){
			alert(arg1 + ':' + arg2)
		})
	}
	var test6 = function(){
		var deferred = iPromise(function(resolve){
			resolve()
		})
		var promise = deferred.then(function(){
			var thenable = {
				then: function(resolve){
					resolve('hello', 'world')
				}
			}	
			return thenable
		})
		// 一秒多后显示hello world
		setTimeout(function(){
			promise.then(function(arg1, arg2){
				alert(arg1 + ' ' + arg2)	
			})	
		}, 1000)
	}
	</script>
</body>
</html>